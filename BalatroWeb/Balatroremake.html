<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Balatro Web</title>
    <style>
      @media (max-width: 700px) {
      .button {
        display: block;
        margin: 5px;
        }
      }
      .chipsloc {
        position: relative;
        top: 200px;
        left: 30px;
      }
    </style>
  </head>
  <body>
    <h3 id="slot1"></h3> <h3 id="slot2"></h3> <h3 id="slot3"></h3> <h3 id="slot4"></h3> <h3 id="slot5"></h3>
    <h3 id="hand"></h3>
    <h3 id="chipsloc">Chips: <span id="chips">0</span></h3> 
    <h3 id="multloc">Mult: <span id="mult">0</span></h3>
    <h3>Score: <span id="score">0</h3>
    <h3>Fire: <span id="fire"></span></h3>
    <button id="card1id" onclick="selectCard(1)"> <span id="card1rank"></span> of <span id="card1suit">          </span></button>
    <button id="card2id" onclick="selectCard(2)"> <span id="card2rank"></span> of <span id="card2suit">          </span></button>
    <button id="card3id" onclick="selectCard(3)"> <span id="card3rank"></span> of <span id="card3suit">          </span></button>
    <button id="card4id" onclick="selectCard(4)"> <span id="card4rank"></span> of <span id="card4suit">          </span></button>
    <br>
    <button onclick="playhand()">Play Hand</button>
   <script>
      
      // ranks: 1 for spades, 2 for hearts, 3 for diamonds, 4 for clubs.
      // aces are considered 14

      if (localStorage.getItem("id") != 1) {
        location.reload();
      }

      let cardsInDeck = [1,2,0,0,2,2,0,0,3,2,0,0,4,2,0,0,1,3,0,0,2,3,0,0,3,3,0,0,4,3,0,0,1,4,0,0,2,4,0,0,3,4,0,0,4,4,0,0,1,5,0,0,2,5,0,0,3,5,0,0,4,5,0,0,1,6,0,0,2,6,0,0,3,6,0,0,4,6,0,0];
      let currentDeck = [1,2,0,0,2,2,0,0,3,2,0,0,4,2,0,0,1,3,0,0,2,3,0,0,3,3,0,0,4,3,0,0,1,4,0,0,2,4,0,0,3,4,0,0,4,4,0,0,1,5,0,0,2,5,0,0,3,5,0,0,4,5,0,0,1,6,0,0,2,6,0,0,3,6,0,0,4,6,0,0];
      let amountOfCardsInHands = 0;
      let cardsSelectedrank = [];
      let cardsSelectedsuit = [];
      let pokerhand = "";
      let mult = 0;
      let chips = 0;
      let score = 0;
      let suitarr = [];
      let handlevel = {
          pair: 0,
          hc: 0,
          toak: 0
      }
      let toak = 0;
      const suits = ["err","Spades", "Hearts", "Diamonds", "Clubs"];
      const ranks = ["err","err",2,3,4,5,6,7,8,9,10,"Jack","Queen","King","Ace"]
      let handSize = 4;
      let pair = false;
      let last = 0;

      let card1 = {
        rank: 14,
        rankstr: "Ace",
        suit: 1,
        suitstr: "Spades",
        isMultCard: 0,
        isRedSeal: 0,
        isSelected: 0,
        cardNum: 1
      }

      let card2 = {
        rank: 14,
        rankstr: "Ace",
        suit: 1,
        suitstr: "Clubs",
        isMultCard: 0,
        isRedSeal: 0,
        isSelected: 0,
        cardNum: 1
      }
      let card3 = {
        rank: 14,
        rankstr: "Ace",
        suit: 1,
        suitstr: "Clubs",
        isMultCard: 0,
        isRedSeal: 0,
        isSelected: 0,
        cardNum: 1
      }
      let card4 = {
        rank: 14,
        rankstr: "Ace",
        suit: 1,
        suitstr: "Clubs",
        isMultCard: 0,
        isRedSeal: 0,
        isSelected: 0,
        cardNum: 1
      }

     
      
      let Jokersheld = {
        Slot1: {
          Name: "Joker",
          Desc: "+4 Mult",
          Id: 2,
          isConditional: 0,
        },
        Slot2: {
          Name: "Joker",
          Desc: "+4 Mult",
          Id: 2,
          isConditional: 0,
        },
      }




      function RNG(min, max) {
          return Math.round(Math.random() * (max - min) + min);
      }
      
      function drawCards() {
        let i = 1;  
        let cardsNeeded = handSize - amountOfCardsInHands;
        while (i <= cardsNeeded){
          let deckSize = currentDeck.length / 4;
          let RNGcard = RNG(1, deckSize);
          if (i == 1) {
            card1.suit = currentDeck[RNGcard * 4 - 4];
            card1.suitstr = suits[currentDeck[RNGcard * 4 - 4]];
            card1.rank = currentDeck[RNGcard * 4 - 3];
            card1.rankstr = ranks[currentDeck[RNGcard * 4 - 3]];
            card1.isMultCard = currentDeck[RNGcard * 4 - 2];
            card1.isRedSeal = currentDeck[RNGcard * 4 - 1];
            currentDeck.splice(RNGcard * 4 - 4, 4);
          } else if (i == 2) {
            card2.suit = currentDeck[RNGcard * 4 - 4];
            card2.suitstr = suits[currentDeck[RNGcard * 4 - 4]];
            card2.rank = currentDeck[RNGcard * 4 - 3];
            card2.rankstr = ranks[currentDeck[RNGcard * 4 - 3]];
            card2.isMultCard = currentDeck[RNGcard * 4 - 2];
            card2.isRedSeal = currentDeck[RNGcard * 4 - 1];
            currentDeck.splice(RNGcard * 4 - 4, 4);
          } else if (i == 3) {
            card3.suit = currentDeck[RNGcard * 4 - 4];
            card3.suitstr = suits[currentDeck[RNGcard * 4 - 4]];
            card3.rank = currentDeck[RNGcard * 4 - 3];
            card3.rankstr = ranks[currentDeck[RNGcard * 4 - 3]];
            card3.isMultCard = currentDeck[RNGcard * 4 - 2];
            card3.isRedSeal = currentDeck[RNGcard * 4 - 1];
            currentDeck.splice(RNGcard * 4 - 4, 4);
          } else if (i == 4) {
            card4.suit = currentDeck[RNGcard * 4 - 4];
            card4.suitstr = suits[currentDeck[RNGcard * 4 - 4]];
            card4.rank = currentDeck[RNGcard * 4 - 3];
            card4.rankstr = ranks[currentDeck[RNGcard * 4 - 3]];
            card4.isMultCard = currentDeck[RNGcard * 4 - 2];
            card4.isRedSeal = currentDeck[RNGcard * 4 - 1];
            currentDeck.splice(RNGcard * 4 - 4, 4);
          }

          i++;
        }
      }

      function writecards() {
        document.getElementById("card1rank").innerHTML = card1.rankstr;
        document.getElementById("card1suit").innerHTML = card1.suitstr;
        document.getElementById("card2rank").innerHTML = card2.rankstr;
        document.getElementById("card2suit").innerHTML = card2.suitstr;
        document.getElementById("card3rank").innerHTML = card3.rankstr;
        document.getElementById("card3suit").innerHTML = card3.suitstr;
        document.getElementById("card4rank").innerHTML = card4.rankstr;
        document.getElementById("card4suit").innerHTML = card4.suitstr;
        document.getElementById("slot1").innerHTML = Jokersheld.Slot1.Name;
        document.getElementById("slot2").innerHTML = Jokersheld.Slot2.Name;
      }

      function selectCard(cardnum) {
        if (cardnum == 1) {
          if (card1.isSelected == 0) {
            card1.isSelected = 1;
          } else {
            card1.isSelected = 0;
          }
        } else if (cardnum == 2) {
          if (card2.isSelected == 0) {
            card2.isSelected = 1;
          } else {
            card2.isSelected = 0;
          }
        } else if (cardnum == 3) {
          if (card3.isSelected == 0) {
            card3.isSelected = 1;
          } else {
            card3.isSelected = 0;
          }
          } else if (cardnum == 4) {
          if (card4.isSelected == 0) {
            card4.isSelected = 1;
          } else {
            card4.isSelected = 0;
          }
        }
        }
      
      const sleep = (delay) => new Promise((resolve) => setTimeout(resolve, delay));
      

      function getAllIndexes(arr, val) {
    var indexes = [], i;
    for(i = 0; i < arr.length; i++)
        if (arr[i] === val)
            indexes.push(i);
    suitarr = indexes;
}


function desc(arr) {
  arr.sort(function(a, b) {
    return b - a;
  });
  return arr;
  }


      async function playhand() {
        cardsSelectedrank = [];
        cardsSelectedsuit = [];
        if (card1.isSelected == 1) {
          cardsSelectedrank.push(card1.rank);
          cardsSelectedsuit.push(card1.suit);
        } 
        if (card2.isSelected == 1) {
          cardsSelectedrank.push(card2.rank);
          cardsSelectedsuit.push(card2.suit);
        }
        if (card3.isSelected == 1) {
          cardsSelectedrank.push(card3.rank);
          cardsSelectedsuit.push(card3.suit);
        }
        if (card4.isSelected == 1) {
          cardsSelectedrank.push(card4.rank);
          cardsSelectedsuit.push(card4.suit);
        }
        
        last = cardsSelectedrank[0];
        for (var i=1; i < cardsSelectedrank.length; i++) {
          if (last == cardsSelectedrank[i]) {
            pair = true;
            break;
          }
          last = cardsSelectedrank[i];
          
        }
        


        alert(last);
        alert(pair);

        let sortnums = desc(cardsSelectedrank);
        let toaknum = 0;
        let count = 1;
        for (var i = 0; i < sortnums.length; i++) {
          toaknum = sortnums[i];
          count = 1;
          for (var j = i + 1; j < sortnums.length; i++) {
            if (sortnums[j] == toaknum) {
              count ++;
              if (count == 3) {
                toak = 1;
                break;
              }
            } 
          }
        }


        // high card is 0, pair is 1, two pair is 2, three of a kind is 4, full house is 5.
        if (toak == 1) {
          pokerhand = 4;
          alert("toak");
          alert(toaknum);
        } else if (pair == 1) {
          pokerhand = 1;
        } else {
          pokerhand = 0;
        }
        //toak
        if (pokerhand == 4) {
          chips = handlevel.toak * 20 + 30;
          mult = handlevel.toak * 2 + 3;
          document.getElementById("chips").innerHTML = chips;
          document.getElementById("mult").innerHTML = mult;
          await sleep(250);
          chips += toaknum;
          getAllIndexes(cardsSelectedrank,toaknum);
          if (Jokersheld.Slot1.Id == 2) {
            if (cardsSelectedsuit[suitarr[0]] == 3) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot1.Id == 3) {
            if (cardsSelectedsuit[suitarr[0]] == 2) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot1.Id == 4) {
            if (cardsSelectedsuit[suitarr[0]] == 1) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot1.Id == 5) {
            if (cardsSelectedsuit[suitarr[0]] == 4) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 2) {
            if (cardsSelectedsuit[suitarr[0]] == 3) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 3) {
            if (cardsSelectedsuit[suitarr[0]] == 2) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 4) {
            if (cardsSelectedsuit[suitarr[0]] == 1) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 5) {
            if (cardsSelectedsuit[suitarr[0]] == 4) {
                mult += 3;
            }
          }
          document.getElementById("mult").innerHTML = mult;
          document.getElementById("chips").innerHTML = chips;
          await sleep(250);
          chips += toaknum;
          if (Jokersheld.Slot1.Id == 2) {
            if (cardsSelectedsuit[suitarr[1]] == 3) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot1.Id == 3) {
            if (cardsSelectedsuit[suitarr[1]] == 2) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot1.Id == 4) {
            if (cardsSelectedsuit[suitarr[1]] == 1) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot1.Id == 5) {
            if (cardsSelectedsuit[suitarr[1]] == 4) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 2) {
            if (cardsSelectedsuit[suitarr[1]] == 3) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 3) {
            if (cardsSelectedsuit[suitarr[1]] == 2) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 4) {
            if (cardsSelectedsuit[suitarr[1]] == 1) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 5) {
            if (cardsSelectedsuit[suitarr[1]] == 4) {
                mult += 3;
            }
          }
          document.getElementById("mult").innerHTML = mult;
          document.getElementById("chips").innerHTML = chips;
          await sleep(250);
          chips += toaknum;
          if (Jokersheld.Slot1.Id == 2) {
            if (cardsSelectedsuit[suitarr[2]] == 3) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot1.Id == 3) {
            if (cardsSelectedsuit[suitarr[2]] == 2) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot1.Id == 4) {
            if (cardsSelectedsuit[suitarr[2]] == 1) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot1.Id == 5) {
            if (cardsSelectedsuit[suitarr[2]] == 4) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 2) {
            if (cardsSelectedsuit[suitarr[2]] == 3) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 3) {
            if (cardsSelectedsuit[suitarr[2]] == 2) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 4) {
            if (cardsSelectedsuit[suitarr[2]] == 1) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 5) {
            if (cardsSelectedsuit[suitarr[2]] == 4) {
                mult += 3;
            }
          }
          document.getElementById("mult").innerHTML = mult;
          document.getElementById("chips").innerHTML = chips;
          await sleep(250);
        } else if (pokerhand == 1) {
          chips = handlevel.pair * 15 + 10;
          mult = handlevel.pair * 1 + 2;
          document.getElementById("chips").innerHTML = chips;
          document.getElementById("mult").innerHTML = mult;
          await sleep(250);
          chips += last;
          getAllIndexes(cardsSelectedrank,last);
          if (Jokersheld.Slot1.Id == 2) {
            if (cardsSelectedsuit[suitarr[0]] == 3) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot1.Id == 3) {
            if (cardsSelectedsuit[suitarr[0]] == 2) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot1.Id == 4) {
            if (cardsSelectedsuit[suitarr[0]] == 1) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot1.Id == 5) {
            if (cardsSelectedsuit[suitarr[0]] == 4) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 2) {
            if (cardsSelectedsuit[suitarr[0]] == 3) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 3) {
            if (cardsSelectedsuit[suitarr[0]] == 2) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 4) {
            if (cardsSelectedsuit[suitarr[0]] == 1) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 5) {
            if (cardsSelectedsuit[suitarr[0]] == 4) {
                mult += 3;
            }
          }
          document.getElementById("mult").innerHTML = mult;
          document.getElementById("chips").innerHTML = chips;
          await sleep(250);
          chips += last;
          if (Jokersheld.Slot1.Id == 2) {
            if (cardsSelectedsuit[suitarr[1]] == 3) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot1.Id == 3) {
            if (cardsSelectedsuit[suitarr[1]] == 2) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot1.Id == 4) {
            if (cardsSelectedsuit[suitarr[1]] == 1) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot1.Id == 5) {
            if (cardsSelectedsuit[suitarr[1]] == 4) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 2) {
            if (cardsSelectedsuit[suitarr[1]] == 3) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 3) {
            if (cardsSelectedsuit[suitarr[1]] == 2) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 4) {
            if (cardsSelectedsuit[suitarr[1]] == 1) {
                mult += 3;
            }
          }
          if (Jokersheld.Slot2.Id == 5) {
            if (cardsSelectedsuit[suitarr[1]] == 4) {
                mult += 3;
            }
          }

          document.getElementById("mult").innerHTML = mult; 
          document.getElementById("chips").innerHTML = chips;
          await sleep(250);
          document.getElementById("chips").innerHTML = chips;
          } else if (pokerhand == 0) {
          let max = cardsSelectedrank[0];
          for (let i = 1; i < cardsSelectedrank.length; i++) {
            if (cardsSelectedrank[i] > max) {
               max = cardsSelectedrank[i];
            }
          }
          document.getElementById("mult").innerHTML = mult;
          chips = handlevel.hc * 10 + 5;
          mult = handlevel.hc * 1 + 1;
          document.getElementById("chips").innerHTML = chips;
          document.getElementById("mult").innerHTML = mult;
          await sleep(250);
          chips += max;
          document.getElementById("chips").innerHTML = chips;
          document.getElementById("mult").innerHTML = mult;
          await sleep(250);
        }
        if (Jokersheld.Slot1.Id == 1) {
          mult += 3;
          document.getElementById("mult").innerHTML = mult;
          await sleep(250);
        }
        if (Jokersheld.Slot1.Id == 1) {
            if (cardsSelectedsuit[suitarr[0]] == 2) {
                mult += 3;
            }
          }
        score = chips * mult;
       
        document.getElementById("score").innerHTML = score;
        
      }

      drawCards();
      writecards();
    </script>
  </body>
</html>
